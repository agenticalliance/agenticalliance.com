<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Agentic News - AI & ML Project Discovery</title>

  <!-- Open Graph -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="Agentic News">
  <meta property="og:description" content="Discover trending AI and machine learning projects from GitHub and Reddit.">
  <meta property="og:url" content="https://agenticalliance.com/news">
  <meta property="og:image" content="https://agenticalliance.com/images/logo.png">
  <meta property="og:site_name" content="Agentic Alliance">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Agentic News">
  <meta name="twitter:description" content="Discover trending AI and machine learning projects from GitHub and Reddit.">
  <meta name="twitter:image" content="https://agenticalliance.com/images/logo.png">

  <!-- General Meta -->
  <meta name="description" content="Discover trending AI and machine learning projects from GitHub and Reddit.">
  <meta name="theme-color" content="#00e6ff">
  <link rel="icon" type="image/png" href="images/logo.png">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg: #0a0a0f;
      --bg-card: rgba(31, 41, 55, 0.5);
      --text: #f8fafc;
      --text-muted: #9ca3af;
      --border: rgba(0, 230, 255, 0.2);
      --border-hover: rgba(0, 230, 255, 0.4);
      --cyan: #00e6ff;
      --cyan-dark: #008b99;
      --github-bg: rgba(55, 65, 81, 1);
      --reddit-bg: rgba(154, 52, 18, 0.3);
      --reddit-text: #fb923c;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.6;
      min-height: 100vh;
    }

    .container { max-width: 900px; margin: 0 auto; padding: 0 1rem; }

    /* Header */
    header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 100;
      background: rgba(10, 10, 15, 0.9);
      backdrop-filter: blur(12px);
      border-bottom: 1px solid var(--border);
      padding: 0.75rem 0;
    }

    .header-content {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      text-decoration: none;
      color: var(--text);
      font-weight: 700;
      font-size: 1.125rem;
    }

    .logo-icon {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: linear-gradient(135deg, #3b82f6, #9333ea);
    }

    .nav-links {
      display: flex;
      align-items: center;
      gap: 1.5rem;
    }

    .nav-links a {
      color: var(--text-muted);
      text-decoration: none;
      font-size: 0.875rem;
      font-weight: 500;
      transition: color 0.2s;
    }

    .nav-links a:hover,
    .nav-links a.active {
      color: var(--cyan);
    }

    /* Hero */
    .hero {
      padding: 8rem 0 2rem;
      text-align: center;
    }

    .hero h1 {
      font-size: 2.5rem;
      font-weight: 700;
      margin-bottom: 0.75rem;
      background: linear-gradient(90deg, var(--cyan), var(--cyan-dark));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .hero p {
      color: var(--text-muted);
      font-size: 1.125rem;
    }

    /* Filters */
    .filters {
      position: sticky;
      top: 57px;
      z-index: 90;
      background: rgba(10, 10, 15, 0.95);
      backdrop-filter: blur(12px);
      border-bottom: 1px solid var(--border);
      padding: 1rem 0;
    }

    .filters-content {
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 1rem;
    }

    .filter-group {
      display: flex;
      gap: 0.5rem;
    }

    .filter-btn {
      padding: 0.5rem 1rem;
      border-radius: 9999px;
      font-size: 0.8125rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      border: 1px solid var(--border);
      background: var(--bg-card);
      color: var(--text-muted);
    }

    .filter-btn:hover {
      border-color: var(--border-hover);
      color: var(--text);
    }

    .filter-btn.active {
      background: var(--cyan);
      border-color: var(--cyan);
      color: #000;
    }

    .source-btn {
      display: flex;
      align-items: center;
      gap: 0.375rem;
      padding: 0.5rem 0.875rem;
      border-radius: 9999px;
      font-size: 0.8125rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      border: 1px solid var(--border);
      background: var(--bg-card);
      color: var(--text-muted);
      opacity: 0.6;
    }

    .source-btn.active {
      opacity: 1;
      color: var(--cyan);
      border-color: var(--border-hover);
    }

    .refresh-btn {
      padding: 0.5rem 1rem;
      border-radius: 9999px;
      font-size: 0.8125rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      border: 1px solid var(--border);
      background: var(--bg-card);
      color: var(--text-muted);
    }

    .refresh-btn:hover { border-color: var(--border-hover); }
    .refresh-btn:disabled { opacity: 0.5; cursor: not-allowed; }

    /* Posts */
    .posts { padding: 1.5rem 0 3rem; }

    .post {
      background: var(--bg-card);
      border-radius: 0.75rem;
      padding: 1rem 1.25rem;
      margin-bottom: 0.75rem;
      border: 1px solid var(--border);
      transition: all 0.2s;
      display: flex;
      gap: 1rem;
    }

    .post:hover {
      border-color: var(--border-hover);
      box-shadow: 0 4px 20px rgba(0, 230, 255, 0.05);
    }

    .post-rank {
      font-size: 0.875rem;
      font-weight: 600;
      color: var(--text-muted);
      min-width: 1.5rem;
      text-align: right;
      padding-top: 0.125rem;
    }

    .post-content { flex: 1; min-width: 0; }

    .post-header {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      flex-wrap: wrap;
      margin-bottom: 0.375rem;
    }

    .post-title {
      font-size: 0.9375rem;
      font-weight: 600;
      color: var(--text);
      text-decoration: none;
      transition: color 0.2s;
    }

    .post-title:hover { color: var(--cyan); }

    .post-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      padding: 0.125rem 0.5rem;
      border-radius: 9999px;
      font-size: 0.75rem;
      font-weight: 600;
    }

    .post-badge.github {
      background: var(--github-bg);
      color: #d1d5db;
    }

    .post-badge.reddit {
      background: var(--reddit-bg);
      color: var(--reddit-text);
    }

    .post-description {
      font-size: 0.8125rem;
      color: var(--text-muted);
      margin-top: 0.25rem;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .post-meta {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-top: 0.5rem;
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    /* Loading */
    .loading, .empty, .error {
      text-align: center;
      padding: 4rem 1rem;
      color: var(--text-muted);
    }

    .error { color: #f87171; }

    .loading-spinner {
      width: 40px;
      height: 40px;
      border: 3px solid var(--border);
      border-top-color: var(--cyan);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      margin: 0 auto 1rem;
    }

    @keyframes spin { to { transform: rotate(360deg); } }

    .progress { max-width: 200px; margin: 1rem auto 0; text-align: left; }

    .progress-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.25rem 0;
      font-size: 0.875rem;
    }

    .progress-item.done { color: #34d399; }
    .progress-item.loading { color: var(--cyan); }
    .progress-item.pending { color: var(--text-muted); opacity: 0.5; }

    /* Footer */
    footer {
      background: #0a1419;
      border-top: 1px solid var(--border);
      padding: 2rem 0;
      text-align: center;
    }

    .cache-info {
      font-size: 0.75rem;
      color: var(--text-muted);
      margin-bottom: 1rem;
    }

    .footer-text {
      font-size: 0.875rem;
      color: var(--text-muted);
    }

    /* Responsive */
    @media (max-width: 640px) {
      .hero h1 { font-size: 2rem; }
      .filters-content { flex-direction: column; align-items: stretch; }
      .filter-group { justify-content: center; }
    }
  </style>
</head>
<body>
  <div id="app"></div>

  <script type="module">
    import { h, render } from 'https://esm.sh/preact@10.19.3';
    import { useState, useEffect, useCallback } from 'https://esm.sh/preact@10.19.3/hooks';
    import htm from 'https://esm.sh/htm@3.1.1';

    const html = htm.bind(h);

    const CACHE_KEY = 'agentic_news_cache';
    const CACHE_DURATION = 30 * 60 * 1000;

    function timeSince(date) {
      const seconds = Math.floor((new Date() - new Date(date)) / 1000);
      const intervals = [
        [31536000, 'y'], [2592000, 'mo'], [86400, 'd'],
        [3600, 'h'], [60, 'm'], [1, 's']
      ];
      for (const [secs, label] of intervals) {
        const interval = Math.floor(seconds / secs);
        if (interval >= 1) return `${interval}${label}`;
      }
      return 'now';
    }

    function getDateDaysAgo(days) {
      const date = new Date();
      date.setDate(date.getDate() - days);
      return date.toISOString().slice(0, 10);
    }

    const sourceConfig = {
      github: { icon: 'â­', label: 'GitHub' },
      reddit: { icon: 'ðŸ‘½', label: 'Reddit' }
    };

    const bannedStrings = ['nft', 'crypto', 'telegram', 'clicker', 'solana', 'stealer'];

    function filterPost(post) {
      if (!post.username?.trim()) return false;
      const name = post.name?.toLowerCase() || '';
      const desc = post.description?.toLowerCase() || '';
      for (const s of bannedStrings) {
        if (name.includes(s) || desc.includes(s)) return false;
      }
      if (name.includes('stake') && name.includes('predict')) return false;
      return true;
    }

    function sortPosts(posts) {
      return [...posts].sort((p1, p2) => {
        const key = p => p.source === 'reddit' ? p.stars * 0.3 : p.stars;
        return key(p2) - key(p1);
      });
    }

    async function fetchGitHub() {
      const posts = [];
      const weekAgo = getDateDaysAgo(7);

      for (let page = 1; page <= 2; page++) {
        try {
          const res = await fetch(
            `https://api.github.com/search/repositories?q=language:python+created:>${weekAgo}&sort=stars&order=desc&per_page=100&page=${page}`
          );
          if (!res.ok) throw new Error(`GitHub API error: ${res.status}`);
          const data = await res.json();

          for (const repo of data.items || []) {
            posts.push({
              id: `gh_${repo.id}`,
              source: 'github',
              username: repo.owner.login,
              name: repo.name,
              stars: repo.stargazers_count,
              description: repo.description,
              url: repo.html_url,
              created_at: repo.created_at
            });
          }
        } catch (e) {
          console.error('GitHub fetch error:', e);
          break;
        }
      }
      return posts;
    }

    async function fetchReddit() {
      const subreddits = ['machinelearning', 'LocalLLaMA', 'StableDiffusion'];
      const posts = [];

      for (const sub of subreddits) {
        try {
          const res = await fetch(
            `https://www.reddit.com/r/${sub}/top.json?t=week&limit=50`
          );
          if (!res.ok) continue;
          const data = await res.json();

          for (const item of data.data?.children || []) {
            const post = item.data;
            posts.push({
              id: `rd_${post.id}`,
              source: 'reddit',
              username: post.author,
              name: post.title,
              stars: post.score,
              description: `/r/${post.subreddit}`,
              url: `https://reddit.com${post.permalink}`,
              created_at: new Date(post.created_utc * 1000).toISOString()
            });
          }
        } catch (e) {
          console.error(`Reddit r/${sub} fetch error:`, e);
        }
      }
      return posts;
    }

    function getCache() {
      try {
        const cached = localStorage.getItem(CACHE_KEY);
        if (!cached) return null;
        const { data, timestamp } = JSON.parse(cached);
        if (Date.now() - timestamp > CACHE_DURATION) return null;
        return { data, age: Date.now() - timestamp };
      } catch {
        return null;
      }
    }

    function setCache(data) {
      try {
        localStorage.setItem(CACHE_KEY, JSON.stringify({ data, timestamp: Date.now() }));
      } catch (e) {
        console.warn('Cache write failed:', e);
      }
    }

    function Post({ post, index }) {
      const cfg = sourceConfig[post.source];
      const isRepo = post.source !== 'reddit';
      const title = isRepo ? `${post.username}/${post.name}` : post.name;
      const description = isRepo ? post.description : `${post.username} on ${post.description}`;

      return html`
        <article class="post">
          <span class="post-rank">${index + 1}.</span>
          <div class="post-content">
            <div class="post-header">
              <a href=${post.url} target="_blank" rel="noopener" class="post-title">
                ${title}
              </a>
              <span class="post-badge ${post.source}">
                ${cfg.icon} ${post.stars.toLocaleString()}
              </span>
            </div>
            ${description && html`<p class="post-description">${description}</p>`}
            <div class="post-meta">
              <span>${cfg.label}</span>
              <span>â€¢</span>
              <span>${timeSince(post.created_at)} ago</span>
            </div>
          </div>
        </article>
      `;
    }

    function LoadingProgress({ progress }) {
      const sources = ['github', 'reddit'];
      return html`
        <div class="loading">
          <div class="loading-spinner"></div>
          <p>Fetching the latest ML projects...</p>
          <div class="progress">
            ${sources.map(s => {
              const status = progress[s];
              const cfg = sourceConfig[s];
              return html`
                <div class="progress-item ${status}">
                  <span>${status === 'done' ? 'âœ“' : 'â—‹'}</span>
                  <span>${cfg.label}</span>
                </div>
              `;
            })}
          </div>
        </div>
      `;
    }

    function App() {
      const [allPosts, setAllPosts] = useState([]);
      const [loading, setLoading] = useState(true);
      const [progress, setProgress] = useState({});
      const [filter, setFilter] = useState('past_week');
      const [sources, setSources] = useState(['github', 'reddit']);
      const [cacheAge, setCacheAge] = useState(null);
      const [error, setError] = useState(null);

      const fetchAll = useCallback(async (force = false) => {
        if (!force) {
          const cached = getCache();
          if (cached) {
            setAllPosts(cached.data);
            setCacheAge(cached.age);
            setLoading(false);
            return;
          }
        }

        setLoading(true);
        setError(null);
        setProgress({ github: 'pending', reddit: 'pending' });

        const results = [];

        setProgress(p => ({ ...p, github: 'loading' }));
        const gh = await fetchGitHub();
        results.push(...gh);
        setProgress(p => ({ ...p, github: 'done', reddit: 'loading' }));

        const rd = await fetchReddit();
        results.push(...rd);
        setProgress(p => ({ ...p, reddit: 'done' }));

        if (results.length === 0) {
          setError('Failed to fetch posts. Try refreshing.');
        } else {
          setAllPosts(results);
          setCache(results);
          setCacheAge(0);
        }

        setLoading(false);
      }, []);

      useEffect(() => { fetchAll(); }, []);

      const filteredPosts = (() => {
        const days = filter === 'past_day' ? 1 : 7;
        const cutoff = new Date();
        cutoff.setDate(cutoff.getDate() - days);

        return sortPosts(
          allPosts
            .filter(p => sources.includes(p.source))
            .filter(p => new Date(p.created_at) >= cutoff)
            .filter(filterPost)
        );
      })();

      function toggleSource(source) {
        if (sources.includes(source)) {
          if (sources.length > 1) setSources(sources.filter(s => s !== source));
        } else {
          setSources([...sources, source]);
        }
      }

      return html`
        <header>
          <div class="container header-content">
            <a href="/" class="logo">
              <div class="logo-icon"></div>
              <span>Agentic Alliance</span>
            </a>
            <nav class="nav-links">
              <a href="/">Home</a>
              <a href="/news.html" class="active">News</a>
              <a href="mailto:info@agenticalliance.com">Contact</a>
            </nav>
          </div>
        </header>

        <section class="hero">
          <div class="container">
            <h1>Agentic News</h1>
            <p>Trending AI & ML projects from GitHub and Reddit</p>
          </div>
        </section>

        <section class="filters">
          <div class="container filters-content">
            <div class="filter-group">
              ${[['past_day', 'Day'], ['past_week', 'Week']].map(([key, label]) => html`
                <button
                  class="filter-btn ${filter === key ? 'active' : ''}"
                  onClick=${() => setFilter(key)}
                >
                  ${label}
                </button>
              `)}
            </div>
            <div class="filter-group">
              ${Object.keys(sourceConfig).map(source => html`
                <button
                  class="source-btn ${sources.includes(source) ? 'active' : ''}"
                  onClick=${() => toggleSource(source)}
                >
                  <span>${sourceConfig[source].icon}</span>
                  <span>${sourceConfig[source].label}</span>
                </button>
              `)}
            </div>
            <button
              class="refresh-btn"
              onClick=${() => fetchAll(true)}
              disabled=${loading}
            >
              ${loading ? 'Loading...' : 'â†» Refresh'}
            </button>
          </div>
        </section>

        <main class="container posts">
          ${loading ? html`
            <${LoadingProgress} progress=${progress} />
          ` : error ? html`
            <div class="error">${error}</div>
          ` : filteredPosts.length === 0 ? html`
            <div class="empty">No posts found. Try adjusting your filters.</div>
          ` : filteredPosts.map((post, i) => html`
            <${Post} post=${post} index=${i} key=${post.id} />
          `)}
        </main>

        <footer>
          ${cacheAge !== null && html`
            <p class="cache-info">
              Data cached ${cacheAge < 60000 ? 'just now' : `${Math.round(cacheAge / 60000)}m ago`} Â· Auto-refreshes every 30 min
            </p>
          `}
          <p class="footer-text">Â© 2024 Agentic Alliance. Advancing the future of Agentic Systems.</p>
        </footer>
      `;
    }

    render(html`<${App} />`, document.getElementById('app'));
  </script>
</body>
</html>
